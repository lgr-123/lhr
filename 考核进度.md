## C.A.T 考核进度汇报



### 1. 总体情况

##### 	1.1 完成的功能

​	本次考核实现了页面的基本页面搭建，注册账号，用户登录和退出，查看个人主页和设置个人信息，音乐播放器播放歌曲、歌词同步，搜索框实现搜索功能等

##### 1.2 页面结构

​	该项目共有8个页面，大体上都是由主页面来进行跳转，在页面跳转需要传递一些数据的时候，都是将数据作为参数附加到url后面



### 2. 各页面详细介绍

##### 2.1 主页面

（1）该页面是整个项目的核心，也是花费时间最久的。点击不同的地方可跳转到不同的页面上去，具体功能如下：

* 动态展示各种信息，该页面上的轮播图，各种榜单歌单，都是调用接口实现的，会实时转换；

* 登录功能： 
  * 当用户没有登录时，点击最上面"登录"时，可跳转到登录界面
  * 当用户登录成功时，会在主页面显示相应的个人信息，此时鼠标经过用户头像时，可点击个人主页和设置，跳往个人主页页面和设置页面
  * 实现关键
    * 调动登录接口，登录成功后可获取用户Id和cookie，将这些作为参数返回主页面，再用封装的函数解析各个参数，由于cookie能判断用户是否登录，所以用户设置这个功能就需要在调用接口的时候将cookie作为参数才能进行设置

* 搜索功能：
  * 当点击最上方的搜索框输入关键词后，调用接口后，可看到搜索到的内容
  * 点击搜索到的歌曲内容时，可播放给歌曲，由于时间原因，其他的地方不能点击播放，但实现的原理都一样
  * 当用户输入关键词后按回车键时，会跳转到搜索页面，此时会把关键词作为参数写在搜索页面的`url`后面
  * 实现关键
    * 当光标在搜索框的时候，触发“input”事件，调用接口，传入关键词，通过模板字符串拼接的方式把搜索到的内容动态展示出来，为了防止用户在输入关键词时频繁触发input事件调用接口，故设置了一个定时器，只有用户输入结束后才会调用接口
    * 当用户点击回车时，会判断用户是否有输入关键词，有的话才能实现跳转
    * 由于搜素到的歌曲标签异步生成的，故无法直接绑定元素，所以可以通过事件委托的方式，将事件绑定在父元素身上，再获得子标签调用接口设置的自定义属性`songid`获取到歌曲id，再调用`playByA(songId)`函数实现播放歌曲
* 歌曲播放功能：
  * 点击最下方榜单（飙升榜这些）的播放按钮时，会播放相应的歌曲
  * 点击“热门推荐”的歌单按钮时，可实现播放该歌单歌曲
  * 播放器上，只要是能够实现播放的歌曲，都可以实现播放与暂停，切换上下首歌，滚动条滚动，实时播放时间和总的播放时间，歌曲名字和歌手名字，歌曲封面，可通过点击滚动条或滑动滚动条设置播放时间，歌曲结束自动播放下一首
  * 实现关键
    * 总的播放实现原理，都过调用接口设置自定义属性获取歌曲id，再把id作为参数赋给音频audio的src属性，实现播放
    * 进度条同步或拖拽进度条实现歌曲同步则是根据比例：`进度条当前宽度 / 进度条总的宽度 == 歌曲目前的播放时间(audio.currentTime)  / 歌曲总的播放时间(audio.duration)`
    * 获取封面，歌曲信息则是通过调用接口实现
    * 歌曲切换功能的实现，是通过是定全局变量和数组，每次播放时，将歌曲id存入到数组中，点击左右切换时，会改变数组索引号并将该数组索引号存入的歌曲id给audio,实现播放
    * 更多的细节，可以看`index.js`代码，里面有很详细的代码注释

（2）页面展示：

![image-20210516172445568](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516172445568.png)

![image-20210516172608917](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516172608917.png)



##### 2.2 搜索界面

（1）具体功能：

* 通过关键词与搜索类型type可以向用户展示不同的内容，但由于时间原因，只能展示“单曲''和”歌手“这两栏，但其他的实现原理也差不多
* 实现关键
  * 判断`url`上的关键词和`type`值，然后调用接口渲染不同的内容
  * 点击不同的关键词时，会把对应的`type`赋给页面`url,`然后重新跳转页面，根据`type`渲染页面
  * 对于点击不同关键词重新加载页面这个做法其实也不是很好，但由于当时写的时候没有想清楚，到了后面也没有时间改了，现在觉得比较好的做法是用<script>存储html,点击不同关键词再把<script>里面的内容渲染出来或者用iframe
  * 下面歌曲是不能播放的，要实现播放的话，由于标签都是动态生成的，顾不能直接绑定事件，可以在父级元素绑定事件，通过事件委托，判断`e.target`实现播放



（2）页面展示：

![image-20210516180006713](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516180006713.png)

![image-20210516175829072](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516175829072.png)



![image-20210516175940382](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516175940382.png)



##### 2.3 歌曲播放界面

（1）该页面是有自己设计的，具体功能如下

* 在主页面点击歌曲名字后，会跳转到歌曲播放页面

* 在页面会显示歌词，点击播放后会实现歌词同步

* 实现关键

  * 获取`url`上歌曲id,调用接口获取歌曲名字，歌词等信息

  * 将歌词通过数组分割的方法分割下来，并添加到页面中去

  * 歌词同步原理： **将每句歌词对应的歌曲时间获取下来，并添加为标签的id属性，当歌曲播放时，实时获取歌曲播放时间，并以此为id绑定元素，被绑定的就是歌词，之后让歌词高亮**

  * 高亮的歌词居中显示的原理：**目的是让歌词能够向上滑动，表现为存放歌词的盒子的`scrolltop`一直在增加， `scrolltop`即是歌词超出盒子顶部的部分，先判断高亮的部分是否位于中间，等到位于中间时，设置歌词盒子的`scrolltop`为歌词`offsetTop` - 2/5*存放歌词盒子的高度，歌词`offsetTop`即为距离盒子最上面（包括溢出的）的距离。**

    

（2） 页面展示

​	![image-20210516182129073](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516182129073.png)

​		

##### 2.4 注册界面

（1）功能介绍

* 用户输入手机号，再输入密码，如果号码没被注册过并且密码格式正确的话，会发送验证码给该手机号码，之后验证验证码是否正确，正确后跳转到登录功能
* 实现关键：
  * 用户输入手机号后，当该表格失去光标时触发事件，先判断用户是否有输入内容，有的话通过正则表达式判断格式是否正确，若正确了调用接口判断该号码是否已被注册过，如不符合以上两点，则会有红色的提示
  * 接着输入密码，还是一样，当该表格失去光标时触发事件，通过一系列正则表达式判断密码格式是否正确，否则提示相应的信息
  * 定义一个变量，只有当上述操作全部符合时，该变量为`true`,当用户点击“下一步”时，若该变量为`true`时，隐藏该盒子，显示下一个盒子，并调用接口给注册的号码发送验证码，此时开启了一个定时器，20秒过后就可以重新发送验证码了
  * 调用接口传入输入的号码和验证码，判断验证验证码是否正确，正确之后则跳转到登录界面
  * 在输入验证码时有个特效，就是当输完一个数字后会直接跳转到另一个`input`上,做法是获取这四个`input`元素，当光标再那个元素上时触发‘'input"事件，判断该`Input`有一个值之后，手动让该`input`失去光标，并把光标移到下一个`input`上



（2） 页面展示

![image-20210516183547039](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516183547039.png)

![](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516183656393.png)

##### 2.5 登录界面

（1） 功能介绍：

* 用户先进行登录，先判断格式是否正确，再判断密码是否正确，密码正确后点击发送验证码，接着可输入验证码验证，正确则跳转主页面，否则提示验证码错误。20秒后可以重新输入验证码。跳转时会带上用户id和cookie,用来设置用户个人信息等

* 实现原理跟注册页面差不多

  

（2）页面展示：

![image-20210516214303781](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516214303781.png)



![image-20210516214328368](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516214328368.png)

![image-20210516214359530](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516214359530.png)

![image-20210516214432283](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516214432283.png)



##### 2.6 个人主页界面

（1） 功能介绍

* 登录成功后，鼠标经过用户头像后点击个人主页可跳转到个人页面，进而显示用户个人信息和听歌排行等
* 实现关键
  * 通过`url`获取用户id，调用接口渲染各个内容

（2） 页面展示

![image-20210516214700265](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516214700265.png)

![image-20210516214715044](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516214715044.png)

##### 2.7 用户设置页面

（1） 功能介绍

* 目前只能更改个人设置里的一些信息，其他的还没有完成
* 实现关键
  * 先调用接口把用户信息显示出来，再进行修改，最后点击保存，需要判断用户是否有修改信息，有点话调用接口，把修改好的值作为参数，要把cookie传进去。调用成功，则跳转到主页面，由于修改后的信息得等一会才能显示，所以不能马上看得到。若调用失败会显示失败原因，最有可能是昵称被占有。

（2）页面展示

![image-20210516221221170](C:\Users\lenovo\AppData\Roaming\Typora\typora-user-images\image-20210516221221170.png)



##### 2.8 用户退出

用户登录后点击退出，此时还是跳转到主页面，但`url`后面没有带任何参数



### 3.收获与体会

* 在写html结构跟css样式会比以前快很多，有时候写着写着也会觉得特别繁琐，所以在写的同时也极大磨炼了自己的耐性与意志力
* 感觉自身知识储备相对于这次考核来说还远远不够，很多内容和功能都是自己之前没有遇到的，同时又没有找到很好的资源去学习，很多东西都是现学现用，同时遇到的bug也会很难以解决
* 考核开始时，感觉没有对考核需要的知识有一个很好的把握，所以就直接开始做，越做越觉得有不会或难以实现的地方，但很多内容都写好了，修改起来也很困难。比较理想的状态是先把需要的知识学会了，再着手去做（比如把node.js学会了的话就可以实现更多的功能）
* 在这一个月的考核，应该是我最认真对待的一次活动了。不管怎样，都感觉自己已经尽最大努力了，过与不过都会欣然接受，也会一直学习前端，朝着目标前进！！！



